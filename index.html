<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drink Record App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #FFFDF9; color: #5D4037; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #FAF7F5; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #D7CCC8; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col items-center text-center">
            <p class="text-[10px] font-bold tracking-[0.6em] text-[#A67C52] mb-3 uppercase">RECORD YOUR CAFFEINE</p>
            <div class="bg-[#BCAAA4] px-10 py-3 rounded-full shadow-sm">
                <h1 class="text-xl md:text-2xl font-black text-white tracking-[0.3em]">D R I N K üßã</h1>
            </div>
        </header>

        <!-- Stats -->
        <div class="flex flex-row gap-3 mb-5">
            <div class="flex-1 bg-white border border-[#E0D7D0] px-4 py-2 rounded-2xl flex items-center gap-2 overflow-hidden shadow-sm">
                <i data-lucide="heart" class="w-3.5 h-3.5 text-[#BCAAA4] fill-current"></i>
                <span class="text-[10px] font-bold text-[#A1887F] uppercase tracking-tighter whitespace-nowrap">FAV SHOPÔºö</span>
                <span id="fav-shop" class="text-[11px] font-black truncate min-h-[1.2em]"></span>
            </div>
            <div class="flex-1 bg-white border border-[#E0D7D0] px-4 py-2 rounded-2xl flex items-center gap-2 overflow-hidden shadow-sm">
                <i data-lucide="award" class="w-3.5 h-3.5 text-[#BCAAA4] fill-current"></i>
                <span class="text-[10px] font-bold text-[#A1887F] uppercase tracking-tighter whitespace-nowrap">FAV ITEMÔºö</span>
                <span id="fav-item" class="text-[11px] font-black truncate min-h-[1.2em]"></span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6 text-center">
            <div class="bg-[#EFEBE9] py-3 px-4 rounded-2xl border border-[#D7CCC8]">
                <p class="text-[9px] font-black text-[#8D6E63] uppercase tracking-widest mb-1">Monthly</p>
                <p id="monthly-stats" class="text-sm font-black">0 CUP / $0</p>
            </div>
            <div class="bg-[#D7CCC8] py-3 px-4 rounded-2xl border border-[#BCAAA4]">
                <p class="text-[9px] font-black text-[#5D4037] uppercase tracking-widest mb-1">Yearly</p>
                <p id="yearly-stats" class="text-sm font-black">0 CUP / $0</p>
            </div>
        </div>

        <!-- Calendar -->
        <div class="bg-white rounded-[2.5rem] shadow-sm border border-[#E0D7D0] overflow-hidden">
            <div class="p-6 flex items-center justify-between bg-white">
                <button onclick="changeMonth(-1)" class="p-2 hover:bg-[#FAF7F5] rounded-full transition-all text-[#BCAAA4]">
                    <i data-lucide="chevron-left"></i>
                </button>
                <div class="flex flex-col items-center">
                    <span id="calendar-year" class="text-[10px] font-bold text-[#A67C52] tracking-[0.3em] mb-1">2026</span>
                    <h2 id="calendar-month" class="text-lg font-black tracking-[0.2em] text-[#5D4037]">JANUARY</h2>
                </div>
                <button onclick="changeMonth(1)" class="p-2 hover:bg-[#FAF7F5] rounded-full transition-all text-[#BCAAA4]">
                    <i data-lucide="chevron-right"></i>
                </button>
            </div>

            <div class="px-6 pb-8">
                <div class="grid grid-cols-7 mb-0 border-b border-[#F5F1EE]">
                    <div id="calendar-headers" class="contents"></div>
                </div>
                <div id="calendar-body" class="grid grid-cols-7 border-l border-t border-[#F5F1EE]"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-[#5D4037]/30 backdrop-blur-sm" onclick="hideAllSuggestions()">
        <div class="bg-white w-full max-w-md max-h-[90vh] rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col border border-[#E0D7D0]" onclick="event.stopPropagation()">
            <div class="p-6 border-b flex items-center justify-between bg-[#FAF7F5]">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-[#BCAAA4] rounded-full flex items-center justify-center text-white">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h3 id="modal-date-title" class="text-lg font-black text-[#5D4037]">JANUARY 01</h3>
                        <p class="text-[10px] font-bold text-[#A67C52] uppercase tracking-[0.2em]">DRINK ENTRY</p>
                    </div>
                </div>
                <button onclick="closeModal()" class="p-2 text-[#D7CCC8] hover:text-[#A67C52] transition-colors">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div id="modal-items-container" class="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar"></div>

            <div class="p-6 bg-[#FAF7F5]">
                <button onclick="closeModal()" class="w-full bg-[#8D6E63] text-white py-4 rounded-xl font-black text-sm hover:bg-[#6D4C41] shadow-lg active:scale-[0.98] uppercase tracking-[0.2em] transition-all">
                    SAVE & CLOSE
                </button>
            </div>
        </div>
    </div>

    <script>
        const MONTH_NAMES = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
        const DAY_NAMES = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        const ICE_OPTIONS = ['Âõ∫ÂÆö', 'Â∞ëÂÜ∞', 'ÂæÆÂÜ∞', 'ÂéªÂÜ∞', 'Â∏∏Ê∫´', 'ÁÜ±'];
        const SUGAR_OPTIONS = ['Âõ∫ÂÆö', 'Â∞ëÁ≥ñ', 'ÂæÆÁ≥ñ', '‰∫åÂàÜÁ≥ñ', '‰∏ÄÂàÜÁ≥ñ', 'ÁÑ°Á≥ñ'];
        
        let currentDate = new Date(2026, 0, 1);
        let records = JSON.parse(localStorage.getItem('drink_records_milk_tea_v8') || '{}');
        let selectedDateKey = null;

        function init() {
            renderHeaders();
            renderCalendar();
            updateStats();
            lucide.createIcons();
        }

        function renderHeaders() {
            document.getElementById('calendar-headers').innerHTML = DAY_NAMES.map(d => `<div class="text-center py-2 text-[9px] font-black text-[#BCAAA4] tracking-widest">${d}</div>`).join('');
        }

        function getDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            document.getElementById('calendar-year').textContent = year;
            document.getElementById('calendar-month').textContent = MONTH_NAMES[month];

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const container = document.getElementById('calendar-body');
            container.innerHTML = '';

            for (let i = 0; i < firstDay; i++) {
                const div = document.createElement('div');
                div.className = 'aspect-square border-r border-b border-[#F5F1EE] bg-[#FCFAF8]';
                container.appendChild(div);
            }

            const todayKey = getDateKey(new Date());
            for (let day = 1; day <= daysInMonth; day++) {
                const dObj = new Date(year, month, day);
                const key = getDateKey(dObj);
                const dayDrinks = records[key] || [];
                const isToday = key === todayKey;

                const btn = document.createElement('button');
                btn.onclick = () => openModal(dObj);
                btn.className = `aspect-square relative flex flex-col border-r border-b border-[#F5F1EE] transition-all group overflow-hidden ${isToday ? 'bg-[#A67C52]/5' : 'bg-white hover:bg-[#FAF7F5]'}`;
                btn.innerHTML = `
                    <span class="text-[10px] md:text-[12px] font-black p-1.5 md:p-2 self-start leading-none ${isToday ? 'text-[#A67C52]' : 'text-[#BCAAA4]'}">${day}</span>
                    <div class="flex flex-wrap items-center justify-center gap-0.5 px-1 mt-auto pb-2">
                        ${dayDrinks.map(d => `<span class="text-[9px] md:text-[11px] leading-none transform group-hover:scale-110 transition-transform">${d.category === 'coffee' ? '‚òïÔ∏è' : 'ü•§'}</span>`).join('')}
                    </div>
                `;
                container.appendChild(btn);
            }
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function updateStats() {
            const allDrinks = Object.values(records).flat();
            const shopCounts = {};
            const itemCounts = {};
            
            allDrinks.forEach(d => {
                if (d.shop && d.shop.trim() !== '') shopCounts[d.shop] = (shopCounts[d.shop] || 0) + 1;
                if (d.item && d.item.trim() !== '') itemCounts[d.item] = (itemCounts[d.item] || 0) + 1;
            });

            const getFav = obj => {
                const sorted = Object.entries(obj).sort((a,b) => b[1]-a[1]);
                return sorted.length > 0 ? sorted[0][0] : '';
            };

            document.getElementById('fav-shop').textContent = getFav(shopCounts);
            document.getElementById('fav-item').textContent = getFav(itemCounts);

            const monthPrefix = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            const yearPrefix = `${currentDate.getFullYear()}-`;
            
            const calcStats = (prefix) => {
                const filtered = Object.keys(records).filter(k => k.startsWith(prefix)).reduce((acc, k) => [...acc, ...records[k]], []);
                const count = filtered.length;
                const spend = filtered.reduce((sum, d) => sum + (Number(d.price) || 0), 0);
                const unit = count === 1 ? 'CUP' : 'CUPS';
                return `${count} ${unit} / $${spend.toLocaleString()}`;
            };
            
            document.getElementById('monthly-stats').textContent = calcStats(monthPrefix);
            document.getElementById('yearly-stats').textContent = calcStats(yearPrefix);
        }

        function openModal(date) {
            selectedDateKey = getDateKey(date);
            document.getElementById('modal-date-title').textContent = `${MONTH_NAMES[date.getMonth()]} ${date.getDate()}`;
            document.getElementById('modal').classList.remove('hidden');
            renderModalItems();
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            renderCalendar();
            updateStats();
        }

        function renderModalItems() {
            const container = document.getElementById('modal-items-container');
            const dayRecords = records[selectedDateKey] || [];
            container.innerHTML = '';

            dayRecords.forEach((drink, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'relative p-5 rounded-2xl bg-[#FFFDF9] border border-[#F5F1EE]';
                itemDiv.innerHTML = `
                    <div class="absolute -top-3 left-4 bg-[#8D6E63] text-white text-[9px] font-black px-3 py-1 rounded-full uppercase tracking-widest shadow-sm">CUP #${index + 1}</div>
                    <button onclick="deleteDrink('${drink.id}')" class="absolute top-4 right-4 text-[#D7CCC8] hover:text-red-400 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    
                    <div class="mt-2 space-y-4">
                        <div>
                            <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-2 block tracking-[0.1em]">CATEGORY</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="updateDrink('${drink.id}', 'category', 'tea')" class="py-2 rounded-lg text-xs font-bold border flex items-center justify-center gap-2 ${drink.category === 'tea' ? 'bg-[#BCAAA4] text-white border-[#BCAAA4]' : 'bg-white text-[#BCAAA4] border-[#F5F1EE]'}">teaü•§</button>
                                <button onclick="updateDrink('${drink.id}', 'category', 'coffee')" class="py-2 rounded-lg text-xs font-bold border flex items-center justify-center gap-2 ${drink.category === 'coffee' ? 'bg-[#BCAAA4] text-white border-[#BCAAA4]' : 'bg-white text-[#BCAAA4] border-[#F5F1EE]'}">coffee‚òïÔ∏è</button>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="relative">
                                <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-1 block tracking-[0.1em]">SHOP</label>
                                <input type="text" value="${drink.shop || ''}" oninput="updateDrink('${drink.id}', 'shop', this.value)" onfocus="showSuggestions('${drink.id}', 'shop', this)" class="w-full bg-[#FAF7F5] px-3 py-2 rounded-lg text-sm outline-none border border-transparent focus:border-[#BCAAA4] text-[#5D4037]">
                                <div id="sugg-shop-${drink.id}" class="absolute z-50 w-full mt-1 bg-white border border-[#E0D7D0] rounded-xl shadow-lg hidden max-h-32 overflow-y-auto custom-scrollbar"></div>
                            </div>
                            <div class="flex items-end gap-3">
                                <div class="flex-1 relative">
                                    <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-1 block tracking-[0.1em]">ITEM</label>
                                    <input type="text" value="${drink.item || ''}" oninput="updateDrink('${drink.id}', 'item', this.value)" onfocus="showSuggestions('${drink.id}', 'item', this)" class="w-full bg-[#FAF7F5] px-3 py-2 rounded-lg text-sm outline-none border border-transparent focus:border-[#BCAAA4] text-[#5D4037]">
                                    <div id="sugg-item-${drink.id}" class="absolute z-50 w-full mt-1 bg-white border border-[#E0D7D0] rounded-xl shadow-lg hidden max-h-32 overflow-y-auto custom-scrollbar"></div>
                                </div>
                                <div class="w-16">
                                    <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-1 block tracking-[0.1em]">$</label>
                                    <input type="number" value="${drink.price || ''}" oninput="updateDrink('${drink.id}', 'price', this.value)" class="w-full bg-[#FAF7F5] px-3 py-2 rounded-lg text-sm outline-none border border-transparent focus:border-[#BCAAA4] text-[#5D4037] text-center">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-2 block tracking-[0.1em]">ICE</label>
                            <div class="grid grid-cols-3 gap-1.5">${ICE_OPTIONS.map(opt => `<button onclick="updateDrink('${drink.id}', 'ice', '${opt}')" class="py-1.5 text-[10px] font-bold rounded-md border ${drink.ice === opt ? 'bg-[#A67C52] text-white border-[#A67C52]' : 'bg-white text-[#BCAAA4] border-[#F5F1EE]'}">${opt}</button>`).join('')}</div>
                        </div>

                        <div>
                            <label class="text-[9px] font-black text-[#D7CCC8] uppercase mb-2 block tracking-[0.1em]">SUGAR</label>
                            <div class="grid grid-cols-3 gap-1.5">${SUGAR_OPTIONS.map(opt => `<button onclick="updateDrink('${drink.id}', 'sugar', '${opt}')" class="py-1.5 text-[10px] font-bold rounded-md border ${drink.sugar === opt ? 'bg-[#A67C52] text-white border-[#A67C52]' : 'bg-white text-[#BCAAA4] border-[#F5F1EE]'}">${opt}</button>`).join('')}</div>
                        </div>
                    </div>
                `;
                container.appendChild(itemDiv);
            });

            if (dayRecords.length < 5) {
                const addBtn = document.createElement('button');
                addBtn.onclick = addDrink;
                addBtn.className = 'w-full py-6 border-2 border-dashed border-[#F5F1EE] rounded-2xl text-[#D7CCC8] font-black flex flex-col items-center gap-2 hover:bg-[#FAF7F5] transition-all';
                addBtn.innerHTML = '<i data-lucide="plus"></i><span class="text-[10px] uppercase tracking-[0.2em]">ADD NEW CUP</span>';
                container.appendChild(addBtn);
            }
            lucide.createIcons();
        }

        function addDrink() {
            if (!records[selectedDateKey]) records[selectedDateKey] = [];
            records[selectedDateKey].push({ id: Date.now().toString(), category: 'tea', shop: '', item: '', price: '', ice: 'ÂæÆÂÜ∞', sugar: 'ÁÑ°Á≥ñ' });
            save();
            renderModalItems();
        }

        function updateDrink(id, field, value) {
            records[selectedDateKey] = records[selectedDateKey].map(d => d.id === id ? { ...d, [field]: value } : d);
            save();
            if (field === 'category' || field === 'ice' || field === 'sugar') renderModalItems();
        }

        function deleteDrink(id) {
            records[selectedDateKey] = records[selectedDateKey].filter(d => d.id !== id);
            save();
            renderModalItems();
        }

        function save() {
            localStorage.setItem('drink_records_milk_tea_v8', JSON.stringify(records));
        }

        function showSuggestions(id, field, input) {
            hideAllSuggestions();
            const allDrinks = Object.values(records).flat();
            const list = [...new Set(allDrinks.map(d => d[field]).filter(v => v && v.trim() !== ''))];
            const filtered = list.filter(v => v.toLowerCase().includes(input.value.toLowerCase()) && v !== input.value);
            const dropdown = document.getElementById(`sugg-${field}-${id}`);
            if (filtered.length > 0) {
                dropdown.innerHTML = filtered.map(v => `<button onmousedown="selectSuggestion('${id}', '${field}', '${v.replace(/'/g, "\\'")}')" class="w-full text-left px-3 py-2 text-xs hover:bg-[#FAF7F5] border-b border-[#F5F1EE] last:border-0">${v}</button>`).join('');
                dropdown.classList.remove('hidden');
            }
        }

        function selectSuggestion(id, field, value) {
            updateDrink(id, field, value);
            renderModalItems();
        }

        function hideAllSuggestions() {
            document.querySelectorAll('[id^="sugg-"]').forEach(d => d.classList.add('hidden'));
        }

        window.onload = init;
    </script>
</body>
</html>
